clear

p = 4.7*2.54/100; % in m
R = 5*2.54/100; % in m 
w = 6000*(2*pi)/60; % in rad/sec
a = 5.7;
cd = 0.07;
V = 0:17;

%geo_data = readmatrix("prop geometry.txt");
x_val = [0.1500    0.2000    0.2500    0.3000    0.3500    0.4000    0.4500    0.5000    0.5500    0.6000    0.6500    0.7000    0.7500    0.8000    0.8500 0.9000    0.9500    1.0000]; % no dimension
c = [0.0138    0.0168    0.0198    0.0224    0.0245    0.0262    0.0274    0.0283    0.0287    0.0286    0.0278    0.0267    0.0250    0.0227    0.0199    0.0165    0.0110    0.0053]; % in m
beta = ([21.1100   23.9000   24.6500   24.1100   22.7800   21.0100   19.0000   17.0600   15.3300   13.8200   12.5100   11.3600   10.2700    9.3200    8.3600    7.2700    6.1500    5.0400] + 5 )*pi/180; % in rad


Ct = zeros(length(V),1);
Cq = zeros(length(V),1);
for i = 1:length(V)

ct_tot = 0;
cq_tot = 0;

    for j=1:length(x_val)-1
        syms x
        sigma = (2*c(j)/(pi*R));
        lambda_c = (V(i)/(w*R));
        
        lambda = max(roots([1 (0.125*sigma*a - lambda_c) -0.125*sigma*a*beta(j)*x_val(j)]));

        dct =  0.5*sigma*a*(beta(j)*(x^2) - lambda*x);
        dcq =  ((0.5*sigma*a*(beta(j)*lambda*x - lambda^2)) + 0.5*sigma*cd*(x^2))*x;        

        ct_ele = int(dct,[x_val(j) x_val(j+1)]);
        cq_ele = int(dcq,[x_val(j) x_val(j+1)]);
        
        ct_tot = ct_tot + ct_ele;
        cq_tot = cq_tot + cq_ele;
    end
 
 Ct(i) = ct_tot;
 Cq(i) = cq_tot;
end

n = 6000/60; % in Rev/sec
D = 2*R; % in m
J = V/(n*D);

Ct = 0.25*(pi^3)*Ct;
Cq = 0.125*(pi^3)*Cq;
Cp = 2*pi*Cq;
 
act_data = transpose([0.0950    0.1210    0.1460    0.1690    0.1920    0.2170    0.2400    0.2670    0.2900    0.3150    0.3340    0.3580    0.3800    0.4070    0.4310 0.4530    0.4770    0.4800    0.5070    0.5280    0.5510    0.5740    0.6010    0.6230    0.6520    0.6710    0.7000    0.7190    0.7470    0.7740; ...
                      0.1171    0.1133    0.1087    0.1048    0.1009    0.0965    0.0932    0.0884    0.0847    0.0805    0.0773    0.0728    0.0685    0.0629    0.0581 0.0532    0.0480    0.0471    0.0405    0.0354    0.0296    0.0235    0.0160    0.0100    0.0017   -0.0039   -0.0123   -0.0178   -0.0265   -0.0347; ...
                      0.0511    0.0507    0.0498    0.0491    0.0484    0.0475    0.0469    0.0459    0.0452    0.0444    0.0438    0.0427    0.0416    0.0399    0.0385 0.0370    0.0354    0.0351    0.0331    0.0315    0.0297    0.0279    0.0254    0.0234    0.0207    0.0189    0.0160    0.0141    0.0112    0.0085; ...
                      0.2170    0.2700    0.3180    0.3600    0.3990    0.4410    0.4770    0.5140    0.5430    0.5720    0.5900    0.6100    0.6260    0.6410    0.6500 0.6520    0.6470    0.6450    0.6220    0.5940    0.5490    0.4840    0.3780    0.2650    0.0520   -0.1390   -0.5400   -0.9060   -1.7730   -3.1710]);

hold on;
plot(J,Ct,'DisplayName','Code Calculated Ct');
plot(J,Cp,'DisplayName','Code Calculated Cp');
plot(act_data(:,1),act_data(:,2),'DisplayName','UIUC Ct')
plot(act_data(:,1),act_data(:,3),'DisplayName','UIUC Cp')
legend